// APP START
// ****************************
// /www/app/assets/app.js is autogenerated. Do not modify.
// Changes should be made in /master/modules/js or /master/components/<component-name>/js
// ****************************
// -----------------------------------

var app = angular.module('krakenApp', ['ngRoute','ngMaterial', 'krakenApp.config', 'krakenApp.Graph', 'krakenApp.services']);

app.factory('menu', [
  '$location',
  '$rootScope',
  'sections',
function($location, $rootScope, sections) {

  var self;

  $rootScope.$on('$locationChangeSuccess', onLocationChange);

  return self = {
    selectSection: function(section) {
      self.openedSection = section;
    },
    selectPage: function(section, page) {
      page && page.url && $location.path(page.url);
      self.currentSection = section;
      self.currentPage = page;
    },
    isPageSelected: function(page) {
      return self.currentPage === page;
    }
  };

  function onLocationChange() {
    var path = $location.path();

    var matchPage = function(section, page) {
      if (path === page.url) {
        self.selectSection(section);
        self.selectPage(section, page);
      }
    };

    sections.forEach(function(section) {
      if(section.children) {
        section.children.forEach(function(childSection){
          if(childSection.pages){
            childSection.pages.forEach(function(page){
              matchPage(childSection, page);
            });
          }
        });
      }
      else if(section.pages) {
        section.pages.forEach(function(page) {
          matchPage(section, page);
        });
      }
      else if (section.type === 'link') {
        matchPage(section, section);
      }
    });
  }
}]);

// stub for config
angular.module("krakenApp.config", []);

angular.module('krakenApp.services',[])
  .factory('globalsFactory', ['ENV', function(ENV){
    return {
        getConstant: function(constantName){
          if (ENV[constantName]) {
            return ENV[constantName];
          } else {
            return false;
          }
        }  
    }
}]);

app.run(function($rootScope, globalsFactory) {
  $rootScope._globals = globalsFactory;
});

app.config(function(k8sApiProvider, ENV){
  if (ENV['k8sApiServer']) {
    k8sApiProvider.setUrlBase(ENV.k8sApiServer);
  }
});

app.config(function(pollK8sDataServiceProvider, ENV){
  if (ENV['k8sDataServer']) {
    pollK8sDataServiceProvider.setEndpointUrl(ENV.k8sDataServer);
  }
  if (ENV['k8sDataPollIntervalMinSec']) {
    pollK8sDataServiceProvider.setPollIntervalSec(ENV.k8sDataPollIntervalMinSec);
  }
  if (ENV['k8sDataPollIntervalMaxSec']) {
    pollK8sDataServiceProvider.setPollIntervalSec(ENV.k8sDataPollIntervalMaxSec);
  }
  if (ENV['k8sDataPollErrorThreshold']) {
    pollK8sDataServiceProvider.setPollErrorThreshold(ENV.k8sDataPollErrorThreshold);
  }
});
